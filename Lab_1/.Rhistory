install.packages("DIMORA")
source("~/Unipd_Magistrale/Business_Economic_and_Financial_Data/Lab_1/Script_lab_1.R", echo=TRUE)
###Libraries##################################
library(readxl)
library(lmtest)
library(forecast)
install.packages("forecast")
library(forecast)
library(DIMORA)
library(fpp2)
install.packages("forecast", dependencies = FALSE)
library(forecast)
##some plots for time series##################
plot(a10, ylab="million dollars", xlab="Year", main="Antidiabetic drugs")
###read the data
facebook<- read_excel("facebook.xlsx")
str(facebook)
##create a variable 'time'
tt<- 1:NROW(facebook)
#create the variable 'fb'
fb <- facebook$fb
##make a plot
plot(tt, fb, xlab="Time", ylab="Facebook users")
acf(fb)
##fit a linear regression model
fit1 <- lm(fb~ tt)
summary(fit1)
##plot of the model
plot(tt, fb, xlab="Time", ylab="Facebook users")
abline(fit1, col=3)
##check the residuals? are they autocorrelated? Test of DW
dwtest(fit1)
##check the residuals
resfit1<- residuals(fit1)
plot(resfit1,xlab="Time", ylab="residuals" )
##let us do the same with a linear model for time series, so we transform the data into a 'ts' object
fb.ts <- ts(fb, frequency = 4)
ts.plot(fb.ts, type="o")
## we fit a linear model with the tslm function
fitts<- tslm(fb.ts~trend)
apple<- read_excel("apple.xlsx")
str(apple)
imac <- apple$iMac
#data visualization
plot(imac,type="l", xlab="quarter", ylab="iMac sales")
#variable tt for a linear model
tt<- 1:NROW(apple)
# linear model
fit2 <- lm(imac~tt)
summary(fit2)
plot(imac,type="l", xlab="quarter", ylab="iMac sales")
abline(fit2, col=3)
dwtest(fit2)
###check the residuals
res2<- residuals(fit2)
plot(res2, xlab="quarter", ylab="residuals", type="l")
acf(res2)
Acf(res2)
acf(res2)
install.packages("forecast")
library(forecast)
library(forecast)
install.packages("DIMORA")
library(DIMORA)
library(fpp2)
install.packages("fpp2")
library(fpp2)
plot(res3, ylab="residuals")
#data transformed as time series
mac.ts<-ts(imac, frequency=4)
#Model with trend and seasonality
fit3 <- tslm(mac.ts~ trend+season)
summary(fit3)
#check the residuals
res3 <- residuals(fit3)
plot(res3, ylab="residuals")
dwtest(fit3)
###plot of the model
plot(mac.ts, ylab="iMac sales", xlab="Time")
lines(fitted(fit3), col=2)
uschange<- uschange
str(uschange)
plot(uschange)
autoplot(uschange)
pairs(uschange)
plot(uschange)
autoplot(uschange)
pairs(uschange)
cons<- uschange[,1]
inc<- uschange[,2]
prod<- uschange[,3]
sav<- uschange[,4]
unem<- uschange[,5]
####consider the series of consumption as dependent variable and study with the other explanatory variables in a multiple regression model
fit.cons<- tslm(cons~inc+prod+sav+unem)
summary(fit.cons)
CV(fit.cons)
plot(cons)
lines(fitted(fit.cons), col=2)
res<- residuals(fit.cons)
plot(res)
acf(res)
Acf(res)
##we remove the 'production' variable
fit.cons1<- tslm(cons~inc+sav+unem)
summary(fit.cons1)
CV(fit.cons1)
beer<- ausbeer
beer
plot(beer)
Acf(beer)
###Music data (RIAA)
music<- read_excel("music.xlsx")
str(music)
##create the variable cassette
cassette<- music$cassette[1:36]
###some simple plots
plot(cassette, type="b")
plot(cumsum(cassette), type="b")
###some simple plots
plot(cassette, type="b")
plot(cumsum(cassette), type="b")
###a better plot of the yearly time series
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
###we estimate a simple Bass Model
bm_cass<-BM(cassette,display = T)
summary(bm_cass)
###prediction (out-of-sample)
pred_bmcas<- predict(bm_cass, newx=c(1:50))
pred.instcas<- make.instantaneous(pred_bmcas)
###plot of fitted model
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred.instcas, lwd=2, col=2)
###some simple plots
plot(cassette, type="b")
###a better plot of the yearly time series
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
###prediction (out-of-sample)
pred_bmcas<- predict(bm_cass, newx=c(1:50))
pred.instcas<- make.instantaneous(pred_bmcas)
###plot of fitted model
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred.instcas, lwd=2, col=2)
###Music data (RIAA)
music<- read_excel("music.xlsx")
str(music)
##create the variable cassette
cassette<- music$cassette[1:36]
###some simple plots
plot(cassette, type="b")
plot(cumsum(cassette), type="b")
###a better plot of the yearly time series
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
###we estimate a simple Bass Model
bm_cass<-BM(cassette,display = T)
summary(bm_cass)
# ascolta da minuto 1:10
###prediction (out-of-sample)
pred_bmcas<- predict(bm_cass, newx=c(1:50))
pred.instcas<- make.instantaneous(pred_bmcas)
###plot of fitted model
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred.instcas, lwd=2, col=2)
bm_cass50<-BM(cassette[1:18],display = T)
summary(bm_cass50)
pred_bmcas50<- predict(bm_cass50, newx=c(1:50))
pred.instcas50<- make.instantaneous(pred_bmcas50)
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred.instcas50, lwd=2, col=2)
###we estimate the model with 25% of the data
bm_cass75<-BM(cassette[1:9],display = T)
summary(bm_cass75)
pred_bmcas75<- predict(bm_cass75, newx=c(1:50))
pred.instcas75<- make.instantaneous(pred_bmcas75)
###Comparison between models (instantaneous)
###instantaneous
plot(cassette, type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred.instcas75, lwd=2, col=2)
lines(pred.instcas50, lwd=2, col=3)
lines(pred.instcas, lwd=2, col=4)
###Comparison between models (cumulative)
plot(cumsum(cassette), type= "b",xlab="Year", ylab="Annual sales",  pch=16, lty=3, xaxt="n", cex=0.6)
axis(1, at=c(1,10,19,28,37), labels=music$year[c(1,10,19,28,37)])
lines(pred_bmcas75, lwd=2, col=2)
lines(pred_bmcas50, lwd=2, col=3)
lines(pred_bmcas, lwd=2, col=4)
